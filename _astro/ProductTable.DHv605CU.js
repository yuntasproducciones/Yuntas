import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{c as q,d as z,i as D}from"./index.DPvrmFMZ.js";import{r as y}from"./index.ai7qpRr1.js";import{S as w}from"./sweetalert2.esm.all.B0Dix5B2.js";import{c as E,g as I}from"./config.DqK_gEEU.js";import{T as R}from"./TableContainer.BM3tcAM5.js";import{h as P}from"./httpService.KKQD0fA1.js";import{u as V}from"./useDarkMode.B3UsSFEU.js";import"./iconBase.CsihB_xR.js";const H=({children:a,isOpen:c,onClose:r,title:i})=>c?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 overflow-y-auto",children:e.jsxs("div",{className:"relative bg-white dark:bg-gray-900 px-5 py-6 rounded-xl max-w-4xl w-full mx-4 my-10 shadow-lg",children:[i&&e.jsx("h2",{className:"text-2xl font-bold mb-4 text-gray-800 dark:text-white",children:i}),e.jsx("button",{onClick:r,className:"absolute top-4 right-5 text-gray-500 hover:text-gray-800 dark:text-gray-300 dark:hover:text-white text-xl","aria-label":"Cerrar",children:"âœ•"}),e.jsx("div",{className:"overflow-y-auto max-h-[75vh] pr-2",children:a})]})}):null,S=a=>{const c=a.target.files?.[0];c&&c.size>2*1024*1024&&(w.fire({icon:"warning",title:"Â¡Imagen muy grande!",text:"MÃ¡x. 2 MB."}),a.target.value="")},W=({initialData:a,onSubmit:c,isEditing:r})=>{y.useEffect(()=>{if(a){console.log("Inicializando especificaciones y beneficios desde specs:",a.especificaciones);const s=a.especificaciones?Object.entries(a.especificaciones).filter(([o])=>o.startsWith("spec_")).map(([,o])=>String(o).trim()):[];x(s.length>0?s:[""]);const t=a.especificaciones?Object.entries(a.especificaciones).filter(([o])=>o.startsWith("beneficio_")).map(([,o])=>String(o).trim()):[];k(t.length>0?t:[""])}},[a]);const[i,b]=y.useState(a?.imagenes||[]),[p,h]=y.useState([]),[u,x]=y.useState((()=>{if(!a?.especificaciones)return[""];const s=Object.entries(a.especificaciones).filter(([t])=>t.startsWith("spec_")).map(([,t])=>String(t));return s.length>0?s:[""]})()),[g,k]=y.useState((()=>{if(!a?.especificaciones)return[""];const s=Object.entries(a.especificaciones).filter(([t])=>t.startsWith("beneficio_")).map(([,t])=>String(t));return s.length>0?s:[""]})()),C=s=>{b(i.filter(t=>t.id!==s)),h([...p,s])},j=(s,t)=>{const o=[...u];o[s]=t,x(o)},n=()=>{u[u.length-1].trim()&&x([...u,""])},d=s=>{u.length>1&&x(u.filter((t,o)=>o!==s))},m=(s,t)=>{const o=[...g];o[s]=t,k(o)},N=()=>{g[g.length-1].trim()&&k([...g,""])},f=s=>{g.length>1&&k(g.filter((t,o)=>o!==s))},_=async s=>{s.preventDefault();const t=new FormData(s.currentTarget),o=new FormData;o.append("nombre",t.get("nombre")),o.append("link",t.get("link")),o.append("titulo",t.get("titulo_hero")),o.append("stock",t.get("stock"));const M=t.get("precio").replace("$","").trim();o.append("precio",M),o.append("subtitulo",t.get("nombre")),o.append("descripcion",t.get("descripcion_informacion")),o.append("seccion",t.get("seccion"));const $=t.get("imagen_lista_productos");$&&$.size>0&&o.append("imagen_principal",$);const A={};u.forEach((l,v)=>{l.trim()&&(A[`spec_${v+1}`]=l.trim())}),g.forEach((l,v)=>{l.trim()&&(A[`beneficio_${v+1}`]=l.trim())}),Object.keys(A).length>0&&Object.entries(A).forEach(([l,v])=>{o.append(`especificaciones[${l}]`,v)});const F=[{key:"imagen_hero",file:t.get("imagen_hero"),index:0},{key:"imagen_especificaciones",file:t.get("imagen_especificaciones"),index:1},{key:"imagen_beneficios",file:t.get("imagen_beneficios"),index:2},{key:"imagen_popups",file:t.get("imagen_popups"),index:3}];console.log("=== DEBUGGING IMÃGENES FRONTEND ===");let O=0;F.forEach(l=>{console.log(`Revisando imagen ${l.index} (${l.key}):`,{hasFile:l.file instanceof File,fileName:l.file?.name||"N/A",fileSize:l.file?.size||0,fileType:l.file?.type||"N/A"}),l.file&&l.file instanceof File&&l.file.size>0?(console.log(`âœ… Agregando imagen ${l.index}:`,l.key,l.file.name,`(${l.file.size} bytes)`),o.append(`imagenes[${l.index}]`,l.file),o.append(`imagen_tipos[${l.index}]`,l.key),O++):console.log(`âŒ Imagen ${l.index} (${l.key}) no tiene archivo vÃ¡lido o estÃ¡ vacÃ­a`)}),console.log(`Total de imÃ¡genes enviadas: ${O}`),p.length>0&&p.forEach((l,v)=>{o.append(`imagenes_eliminar[${v}]`,l)});const B=t.get("meta_tÃ­tulo"),L=t.get("meta_descripcion");(B.trim()||L.trim())&&(o.append("etiqueta[meta_titulo]",B.trim()),o.append("etiqueta[meta_descripcion]",L.trim())),console.log("=== DATOS ENVIADOS AL BACKEND ==="),o.forEach((l,v)=>{l instanceof File?console.log(`Campo: ${v}, Archivo: ${l.name} (${l.size} bytes)`):console.log(`Campo: ${v}, Valor: ${l}`)}),r&&o.append("_method","PUT"),await c(o)};return e.jsxs("form",{id:"product-form",onSubmit:_,className:"space-y-8 max-w-4xl mx-auto p-6",children:[e.jsxs("div",{className:"bg-blue-50 p-6 rounded-lg border border-blue-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-4 flex items-center",children:"Datos para Dashboard (GestiÃ³n Interna)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Nombre del Producto ",e.jsx("span",{className:"text-blue-600 text-sm",children:"(Aparece en tabla)"})]}),e.jsx("input",{name:"nombre",defaultValue:a?.nombre||a?.titulo,className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-blue-500 focus:border-blue-500",required:!0}),e.jsx("small",{className:"text-gray-500 block mt-1",children:"MÃ¡x. 255 caracteres (letras, nÃºmeros y espacios)."})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["SecciÃ³n/CategorÃ­a ",e.jsx("span",{className:"text-blue-600 text-sm",children:"(Aparece en tabla)"})]}),e.jsx("input",{name:"seccion",defaultValue:a?.seccion,placeholder:"ej: Letreros LED, Sillas LED, Pisos LED, etc.",className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-blue-500 focus:border-blue-500",required:!0}),e.jsx("small",{className:"text-gray-500 block mt-1",children:"MÃ¡x. 255 caracteres (letras, nÃºmeros y espacios)."})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Precio ",e.jsx("span",{className:"text-blue-600 text-sm",children:"(Aparece en tabla)"})]}),e.jsx("input",{name:"precio",defaultValue:a?.precio?`$${a.precio}`:a?.precio,placeholder:"ej: $500.00",className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-blue-500 focus:border-blue-500",required:!0}),e.jsx("small",{className:"text-gray-500 block mt-1",children:"Coloca el precio en nÃºmeros (mÃ¡x. 100 000)."})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Link/URL ",e.jsx("span",{className:"text-blue-600 text-sm",children:"(ej: letreros-neon-led)"})]}),e.jsx("input",{name:"link",defaultValue:a?.link||(a?.titulo?a.titulo.toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]/g,""):""),placeholder:"letreros-neon-led",className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-blue-500 focus:border-blue-500",required:!0}),e.jsx("small",{className:"text-gray-500 block mt-1",children:"Solo minÃºsculas y guiones. Hasta 255 letras, nÃºmeros o espacios."})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Meta TÃ­tulo ",e.jsx("span",{className:"text-blue-600 text-sm",children:"(SEO)"})]}),e.jsx("input",{name:"meta_tÃ­tulo",defaultValue:a?.etiqueta?.meta_titulo||"",placeholder:"TÃ­tulo para SEO del producto",className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-blue-500 focus:border-blue-500"}),e.jsx("small",{className:"text-gray-500 block mt-1",children:"MÃ¡x. 70 caracteres (letras, nÃºmeros y espacios)."})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Meta DescripciÃ³n ",e.jsx("span",{className:"text-blue-600 text-sm",children:"(SEO)"})]}),e.jsx("textarea",{name:"meta_descripcion",defaultValue:a?.etiqueta?.meta_descripcion||"",rows:3,className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"DescripciÃ³n breve del producto para SEO..."}),e.jsx("small",{className:"text-gray-500 block mt-1",children:"MÃ¡x. 160 caracteres (letras, nÃºmeros y espacios)."})]})]})]}),e.jsxs("div",{className:"bg-green-50 p-6 rounded-lg border border-green-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-green-800 mb-4 flex items-center",children:"Datos para PÃ¡gina de Producto (Frontend)"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["TÃ­tulo Hero ",e.jsx("span",{className:"text-green-600 text-sm",children:"(Aparece sobre la imagen principal)"})]}),e.jsx("input",{name:"titulo_hero",defaultValue:a?.titulo,placeholder:"ej: Letreros NeÃ³n LED",className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-green-500 focus:border-green-500",required:!0}),e.jsx("small",{className:"text-gray-500 block mt-1",children:"MÃ¡x. 255 caracteres (letras, nÃºmeros y espacios)."})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["DescripciÃ³n ",e.jsx("span",{className:"text-green-600 text-sm",children:'(SecciÃ³n "InformaciÃ³n")'})]}),e.jsx("textarea",{rows:4,name:"descripcion_informacion",defaultValue:a?.descripcion,placeholder:"Describe el producto, sus usos y caracterÃ­sticas principales...",className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-green-500 focus:border-green-500",required:!0}),e.jsx("small",{className:"text-gray-500 block mt-1",children:"DescripciÃ³n detallada. 300-600 palabras."})]})]})]}),e.jsxs("div",{className:"bg-purple-50 p-6 rounded-lg border border-purple-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-purple-800 mb-4 flex items-center",children:"Especificaciones (Checkmarks en el producto)"}),e.jsxs("div",{className:"space-y-3",children:[u.map((s,t)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{type:"text",value:s,onChange:o=>j(t,o.target.value),placeholder:"ej: Materiales duraderos",className:"flex-1 border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-purple-500 focus:border-purple-500"}),u.length>1&&e.jsx("button",{type:"button",onClick:()=>d(t),className:"text-red-500 hover:text-red-700 px-2 py-1",children:"âœ•"})]},t)),e.jsx("button",{type:"button",onClick:n,className:"text-purple-600 hover:text-purple-800 text-sm font-medium",children:"+ Agregar especificaciÃ³n"})]})]}),e.jsxs("div",{className:"bg-orange-50 p-6 rounded-lg border border-orange-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-orange-800 mb-4 flex items-center",children:"Beneficios (Lista en el producto)"}),e.jsxs("div",{className:"space-y-3",children:[g.map((s,t)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{type:"text",value:s,onChange:o=>m(t,o.target.value),placeholder:"ej: IluminaciÃ³n con colores vibrantes",className:"flex-1 border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-orange-500 focus:border-orange-500"}),g.length>1&&e.jsx("button",{type:"button",onClick:()=>f(t),className:"text-red-500 hover:text-red-700 px-2 py-1",children:"âœ•"})]},t)),e.jsx("button",{type:"button",onClick:N,className:"text-orange-600 hover:text-orange-800 text-sm font-medium",children:"+ Agregar beneficio"})]})]}),e.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:"ImÃ¡genes del Producto (4 imÃ¡genes especÃ­ficas requeridas)"}),i.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-md font-medium text-gray-700 mb-3",children:"ImÃ¡genes actuales"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:i.map(s=>e.jsxs("div",{className:"flex flex-col items-center p-4 bg-white rounded-lg shadow-sm border hover:shadow-md transition",children:[e.jsx("img",{src:`${s.url_imagen}`,alt:s.texto_alt_SEO,className:"w-32 h-32 object-cover rounded-lg mb-2"}),e.jsx("span",{className:"text-center text-gray-700 text-sm mb-2",children:s.texto_alt_SEO}),e.jsx("button",{type:"button",onClick:()=>C(s.id),className:"bg-red-100 text-red-600 text-xs px-3 py-1 rounded-full hover:bg-red-200 transition",children:"Eliminar"})]},s.id))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-blue-200",children:[e.jsxs("h4",{className:"text-md font-semibold text-blue-700 mb-3",children:["Imagen para Lista de Productos ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("p",{className:"text-sm text-gray-600 mb-3",children:['Esta imagen aparece en la pÃ¡gina "Nuestros Productos" y es ',e.jsx("strong",{children:"obligatoria"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"file",accept:"image/*",name:"imagen_lista_productos",required:!r,className:"w-full text-sm text-gray-600 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100",onChange:S}),e.jsx("small",{className:"text-gray-500 block mt-1",children:"Cada imagen debe pesar menos de 2 MB."}),e.jsx("input",{type:"text",name:"alt_imagen_lista",placeholder:"Texto ALT para SEO",className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-green-200",children:[e.jsxs("h4",{className:"text-md font-semibold text-green-700 mb-3",children:["ðŸŽ¯ Imagen Hero del Producto ",e.jsx("span",{className:"text-sm text-gray-500",children:"(Banner Principal)"})]}),e.jsxs("p",{className:"text-sm text-gray-600 mb-3",children:["Imagen de fondo grande en la pÃ¡gina individual del producto - ",e.jsx("strong",{children:"Banner superior principal"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"file",accept:"image/*",name:"imagen_hero",className:"w-full text-sm text-gray-600 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-green-50 file:text-green-700 hover:file:bg-green-100",onChange:S}),e.jsx("small",{className:"text-gray-500 block mt-1",children:"Cada imagen debe pesar menos de 2 MB."}),e.jsx("input",{type:"text",name:"alt_imagen_hero",placeholder:"Texto ALT para SEO",className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-green-500 focus:border-green-500"})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-purple-200",children:[e.jsxs("h4",{className:"text-md font-semibold text-purple-700 mb-3",children:["ðŸ“‹ Imagen para Especificaciones ",e.jsx("span",{className:"text-sm text-gray-500",children:"(SecciÃ³n Izquierda)"})]}),e.jsxs("p",{className:"text-sm text-gray-600 mb-3",children:["Imagen que acompaÃ±a la secciÃ³n de especificaciones - ",e.jsx("strong",{children:"Lado izquierdo de la pÃ¡gina"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"file",accept:"image/*",name:"imagen_especificaciones",className:"w-full text-sm text-gray-600 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-purple-50 file:text-purple-700 hover:file:bg-purple-100",onChange:S}),e.jsx("small",{className:"text-gray-500 block mt-1",children:"Cada imagen debe pesar menos de 2 MB."}),e.jsx("input",{type:"text",name:"alt_imagen_especificaciones",placeholder:"Texto ALT para SEO",className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-purple-500 focus:border-purple-500"})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-orange-200",children:[e.jsxs("h4",{className:"text-md font-semibold text-orange-700 mb-3",children:["ðŸŽ Imagen para Beneficios ",e.jsx("span",{className:"text-sm text-gray-500",children:"(SecciÃ³n Derecha)"})]}),e.jsxs("p",{className:"text-sm text-gray-600 mb-3",children:["Imagen que acompaÃ±a la secciÃ³n de beneficios - ",e.jsx("strong",{children:"Lado derecho de la pÃ¡gina"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"file",accept:"image/*",name:"imagen_beneficios",className:"w-full text-sm text-gray-600 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-orange-50 file:text-orange-700 hover:file:bg-orange-100",onChange:S}),e.jsx("small",{className:"text-gray-500 block mt-1",children:"Cada imagen debe pesar menos de 2 MB."}),e.jsx("input",{type:"text",name:"alt_imagen_beneficios",placeholder:"Texto ALT para SEO",className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500"})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-yellow-200",children:[e.jsx("h4",{className:"text-md font-semibold text-yellow-700 mb-3",children:"ðŸ’¬ Imagen para Popups"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Imagen que acompaÃ±a los popups de registro clientes"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"file",accept:"image/*",name:"imagen_popups",className:"w-full text-sm text-gray-600 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-yellow-50 file:text-yellow-700 hover:file:bg-yellow-100",onChange:S}),e.jsx("small",{className:"text-gray-500 block mt-1",children:"Cada imagen debe pesar menos de 2 MB."}),e.jsx("input",{type:"text",name:"alt_imagen_popups",placeholder:"Texto ALT para SEO",className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-yellow-500 focus:border-yellow-500"})]})]}),e.jsx("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-yellow-800",children:[e.jsx("strong",{children:"ðŸ’¡ Estructura CORRECTA de imÃ¡genes:"}),e.jsx("br",{}),"ðŸ“¸ ",e.jsx("strong",{children:"Lista Productos:"})," Imagen para vista de catÃ¡logo (imagen_principal)",e.jsx("br",{}),"ðŸŽ¯ ",e.jsx("strong",{children:"Hero:"})," Banner principal superior (images[0])",e.jsx("br",{}),"ðŸ“‹ ",e.jsx("strong",{children:"Especificaciones:"})," AcompaÃ±a caracterÃ­sticas (images[1])",e.jsx("br",{}),"ðŸŽ ",e.jsx("strong",{children:"Beneficios:"})," AcompaÃ±a ventajas (images[2])",e.jsx("br",{}),"ðŸ’¬ ",e.jsx("strong",{children:"Popups:"})," AcompaÃ±a popups registro (images[3])"]})})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-6 border-t border-gray-200",children:[e.jsx("button",{type:"button",className:"px-6 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600 transition",children:"Cancelar"}),e.jsxs("button",{type:"submit",className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition",children:[r?"Actualizar":"Crear"," Producto"]})]})]})};class G{async getAllProductos(c=1,r=6){try{const i=`${E.endpoints.productos.list}?page=${c}&perPage=${r}`,b=await P.get(i);return console.log("response from getAllProductos2:",b),b}catch(i){throw console.error("[ProductoService] Error obteniendo productos:",i),i}}async getProductoById(c){try{return await P.get(E.endpoints.productos.detail(c))}catch(r){throw console.error("[ProductoService] Error obteniendo producto:",r),r}}async createProducto(c){try{const r=this.buildFormData(c);return await P.authenticatedPostFormData(E.endpoints.productos.create,r)}catch(r){throw console.error("[ProductoService] Error creando producto:",r),r}}async updateProducto(c,r){try{const i=this.buildFormData(r);return await P.authenticatedPutFormData(E.endpoints.productos.update(c),i)}catch(i){throw console.error("[ProductoService] Error actualizando producto:",i),i}}async deleteProducto(c){try{return await P.authenticatedDelete(E.endpoints.productos.delete(c))}catch(r){throw console.error("[ProductoService] Error eliminando producto:",r),r}}buildFormData(c){const r=new FormData;return r.append("link",c.link),r.append("nombre",c.nombre),r.append("titulo",c.titulo),r.append("descripcion",c.descripcion),r.append("seccion",c.seccion),c.imagen_principal_file&&r.append("imagen_principal",c.imagen_principal_file),c.imagenes_files&&c.imagenes_files.forEach((i,b)=>{r.append(`imagenes[${b}]`,i)}),r}}const T=new G;function U(){const[a,c]=y.useState([]),[r,i]=y.useState(!0),[b,p]=y.useState(null),[h,u]=y.useState({current_page:1,last_page:1,per_page:6,total:0});console.log("PRODUCTOS HOOK:",a);const x=async(j=1,n=h.per_page)=>{i(!0),p(null);try{const d=await T.getAllProductos(j,n);console.log("response from getAllProductos:",d.data),c(d.data),u({current_page:d.current_page,last_page:d.last_page,per_page:d.per_page,total:d.total})}catch(d){p(d instanceof Error?d.message:"Error desconocido al obtener productos"),console.error("Error en useProducts:",d)}finally{i(!1)}},g=async(j,n)=>{await x(j,n)};return y.useEffect(()=>{x(h.current_page,h.per_page)},[]),{productos:a,loading:r,error:b,pagination:h,refetch:g,createProduct:async j=>{i(!0),p(null);try{const n=await T.createProducto(j);return g(h.current_page),n.data}catch(n){return p(n instanceof Error?n.message:"Error desconocido al crear producto"),console.error("Error al crear producto:",n),null}finally{i(!1)}},updateProduct:async(j,n)=>{i(!0),p(null);try{const d=await T.updateProducto(j,n);if(!d.data)throw new Error("Producto no encontrado");return c(m=>m.map(N=>N.id===j?d.data:N)),d.data}catch(d){return p(d instanceof Error?d.message:"Error desconocido al actualizar producto"),console.error("Error al actualizar producto:",d),null}finally{i(!1)}}}}function te(){const{productos:a,loading:c,pagination:r,refetch:i}=U(),[b,p]=y.useState(!1),[h,u]=y.useState(void 0),{darkMode:x}=V();console.log("Productos cargados:",a);const g=async n=>{const d=I(E.endpoints.productos.delete(n)),m=localStorage.getItem("token");if(!m){w.fire({title:"Error de autenticaciÃ³n",text:"No se encontrÃ³ token de acceso. Por favor inicia sesiÃ³n nuevamente.",icon:"error",confirmButtonText:"Entendido"});return}if((await w.fire({title:"Â¿EstÃ¡s seguro?",text:"Â¡Esta acciÃ³n no se puede deshacer!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"SÃ­, eliminar",cancelButtonText:"Cancelar"})).isConfirmed)try{const f=await fetch(d,{method:"DELETE",headers:{Accept:"application/json",Authorization:`Bearer ${m}`,"X-Requested-With":"XMLHttpRequest"}}),_=await f.json();if(f.ok)w.fire("Â¡Eliminado!",_.message,"success"),i(r.current_page);else{let s=_.message||"Error desconocido al eliminar";f.status===401?(s="Token expirado o invÃ¡lido. Por favor inicia sesiÃ³n nuevamente.",localStorage.removeItem("token")):f.status===403?s="Acceso denegado. No tienes permisos para eliminar productos.":f.status===404&&(s="El producto no existe o ya fue eliminado."),w.fire("Error",s,"error")}}catch{w.fire("Error","No se pudo conectar con el servidor.","error")}},k=n=>{i(n,r.per_page)},C=n=>{u(n),p(!0)},j=async function(n){const d=I(E.endpoints.productos.create),m=localStorage.getItem("token");if(!m){w.fire("Error","No hay token de autenticaciÃ³n. Por favor inicia sesiÃ³n.","error");return}try{const N=h?I(E.endpoints.productos.update(h.id)):d,f=await fetch(N,{method:"POST",headers:{Accept:"application/json",Authorization:`Bearer ${m}`,"X-Requested-With":"XMLHttpRequest"},body:n}),_=await f.json();if(f.ok)w.fire({title:`${_.message||"Producto guardado exitosamente"}`,icon:"success"}),p(!1),i(r.current_page);else{let s=_.message||"Error desconocido";f.status===401?(s="Token expirado o invÃ¡lido. Por favor inicia sesiÃ³n nuevamente.",localStorage.removeItem("token")):f.status===403?s="Acceso denegado. Permisos insuficientes.":f.status===422&&(s="Datos invÃ¡lidos: "+(_.message||"Verifica los campos del formulario")),w.fire("Error",s,"error")}}catch{w.fire({title:"Hubo un error al insertar el producto",icon:"error"})}};return y.useEffect(()=>(b?document.body.style.overflow="hidden":document.body.style.overflow="auto",()=>{document.body.style.overflow="auto"}),[b]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-row gap-4 mb-4",children:e.jsx("button",{onClick:()=>{u(void 0),p(!0)},className:"mt-4 bg-blue-950 hover:bg-blue-800 text-white text-lg px-10 py-1.5 rounded-full flex items-center gap-2",children:"AÃ±adir Producto"})}),e.jsx("div",{className:"overflow-x-auto p-4",children:e.jsxs(R,{tableType:"productos",children:[e.jsx("thead",{className:"hidden md:table-header-group",children:e.jsx("tr",{children:["ID","Nombre","SecciÃ³n","Precio","AcciÃ³n"].map(n=>e.jsx("th",{className:`px-4 py-2 text-white uppercase text-xs font-bold rounded-md ${x?"bg-cyan-900":"bg-cyan-400"}`,children:n},n))})}),e.jsx("tbody",{children:c?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center py-12",children:e.jsxs("div",{className:"flex justify-center items-center gap-3",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-teal-500"}),e.jsx("span",{className:"text-teal-500 font-medium",children:"Cargando productos..."})]})})}):a.length>0?a.map((n,d)=>{const m=d%2===0&&x?"bg-white text-black":"text-black bg-white",N=n.id??`producto-${d}`;return e.jsxs("tr",{className:`text-center md:table-row block md:mb-0 mb-4 rounded-lg shadow-sm ${m}`,children:[e.jsx("td",{"data-label":"ID",className:`px-4 py-2 font-bold border block md:table-cell ${x?"bg-gray-300":"bg-white"}`,children:n.id}),e.jsx("td",{"data-label":"Nombre",className:`px-4 py-2 font-bold border block md:table-cell ${x?"bg-gray-300":"bg-white"}`,children:n.nombre}),e.jsx("td",{"data-label":"SecciÃ³n",className:`px-4 py-2 font-bold border block md:table-cell ${x?"bg-gray-300":"bg-white"}`,children:n.seccion}),e.jsxs("td",{"data-label":"Precio",className:`px-4 py-2 font-bold border block md:table-cell ${x?"bg-gray-300":"bg-white"}`,children:["$",n.precio?n.precio.toFixed(2):""]}),e.jsx("td",{"data-label":"AcciÃ³n",className:`px-4 py-2 border block md:table-cell ${x?"bg-gray-300":"bg-white"}`,children:e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsx("button",{onClick:()=>C(n),className:"flex items-center justify-center gap-2 p-2 text-yellow-600 hover:text-yellow-800 transition bg-yellow-100 rounded-lg shadow-sm",title:"Editar",children:e.jsx(q,{size:18})}),e.jsx("button",{onClick:()=>g(n.id),className:"flex items-center justify-center gap-2 p-2 text-red-600 hover:text-red-800 transition bg-red-100 rounded-lg shadow-sm",title:"Eliminar",children:e.jsx(z,{size:18})})]})})]},N)}):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center py-16 text-gray-500",children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2",children:[e.jsx("div",{className:"bg-teal-50 p-6 rounded-full",children:e.jsx(D,{className:"h-10 w-10 text-teal-300"})}),e.jsx("p",{className:"text-xl font-medium text-gray-600 mt-4",children:"No hay productos registrados"}),e.jsx("p",{className:"text-gray-400 max-w-md mx-auto",children:"Comienza agregando productos a tu catÃ¡logo con el botÃ³n 'AÃ±adir Producto'"})]})})})})]})}),r.last_page>1&&e.jsxs("div",{className:"flex justify-center items-center mt-4 gap-2",children:[e.jsx("button",{onClick:()=>k(r.current_page-1),disabled:r.current_page===1,className:"px-4 py-2 bg-blue-950 text-white rounded-md disabled:opacity-50 disabled:cursor-not-allowed",children:"Anterior"}),e.jsx("div",{className:"flex gap-1",children:Array.from({length:r.last_page},(n,d)=>{const m=d+1;return e.jsx("button",{onClick:()=>k(m),className:`px-3 py-2 rounded-md ${r.current_page===m?"bg-blue-950 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:m},m)})}),e.jsx("button",{onClick:()=>k(r.current_page+1),disabled:r.current_page===r.last_page,className:"px-4 py-2 bg-blue-950 text-white rounded-md disabled:opacity-50 disabled:cursor-not-allowed",children:"Siguiente"})]}),e.jsx(H,{isOpen:b,onClose:()=>{p(!1),u(void 0)},title:h?"Editar Datos":"Ingresar Datos",children:e.jsx(W,{initialData:h,onSubmit:j,isEditing:!!h})})]})}export{te as default};
