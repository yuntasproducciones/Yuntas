import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{e as F,c as R,j as z}from"./index.C2rrZm7j.js";import{r as x}from"./index.ai7qpRr1.js";import{S as j}from"./sweetalert2.esm.all.B0Dix5B2.js";import{c as E,g as O}from"./config.CT_CG-Xn.js";import{T as M}from"./TableContainer.b9hjZr1F.js";import{h as C}from"./httpService.BWjNqOJ0.js";import"./iconBase.CsihB_xR.js";const V=({children:o,isOpen:n,onClose:a,title:c})=>n?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 overflow-y-auto",children:e.jsxs("div",{className:"relative bg-white dark:bg-gray-900 px-5 py-6 rounded-xl max-w-4xl w-full mx-4 my-10 shadow-lg",children:[c&&e.jsx("h2",{className:"text-2xl font-bold mb-4 text-gray-800 dark:text-white",children:c}),e.jsx("button",{onClick:a,className:"absolute top-4 right-5 text-gray-500 hover:text-gray-800 dark:text-gray-300 dark:hover:text-white text-xl","aria-label":"Cerrar",children:"âœ•"}),e.jsx("div",{className:"overflow-y-auto max-h-[75vh] pr-2",children:o})]})}):null,H=({initialData:o,onSubmit:n,isEditing:a})=>{x.useEffect(()=>{if(o){console.log("Inicializando especificaciones y beneficios desde specs:",o.especificaciones);const t=o.especificaciones?Object.entries(o.especificaciones).filter(([s])=>s.startsWith("spec_")).map(([,s])=>String(s).trim()):[];u(t.length>0?t:[""]);const r=o.especificaciones?Object.entries(o.especificaciones).filter(([s])=>s.startsWith("beneficio_")).map(([,s])=>String(s).trim()):[];p(r.length>0?r:[""])}},[o]);const[c,N]=x.useState(o?.imagenes||[]),[b,v]=x.useState([]),[k,P]=x.useState(""),[f,u]=x.useState((()=>{if(!o?.especificaciones)return[""];const t=Object.entries(o.especificaciones).filter(([r])=>r.startsWith("spec_")).map(([,r])=>String(r));return t.length>0?t:[""]})()),[i,p]=x.useState((()=>{if(!o?.especificaciones)return[""];const t=Object.entries(o.especificaciones).filter(([r])=>r.startsWith("beneficio_")).map(([,r])=>String(r));return t.length>0?t:[""]})()),_=t=>{N(c.filter(r=>r.id!==t)),v([...b,t])},w=(t,r)=>{const s=[...f];s[t]=r,u(s)},S=()=>{f[f.length-1].trim()&&u([...f,""])},A=t=>{f.length>1&&u(f.filter((r,s)=>s!==t))},T=(t,r)=>{const s=[...i];s[t]=r,p(s)},l=()=>{i[i.length-1].trim()&&p([...i,""])},y=t=>{i.length>1&&p(i.filter((r,s)=>s!==t))},d=async t=>{t.preventDefault();const r=new FormData(t.currentTarget),s=new FormData;s.append("nombre",r.get("nombre")),s.append("link",r.get("link")),s.append("titulo",r.get("titulo_hero")),s.append("stock",r.get("stock"));const g=r.get("precio").replace("$","").trim();s.append("precio",g),s.append("subtitulo",r.get("nombre")),s.append("descripcion",r.get("descripcion_informacion")),s.append("seccion",r.get("seccion"));const $=r.get("imagen_lista_productos");$&&$.size>0&&s.append("imagen_principal",$);const I={};f.forEach((m,h)=>{m.trim()&&(I[`spec_${h+1}`]=m.trim())}),i.forEach((m,h)=>{m.trim()&&(I[`beneficio_${h+1}`]=m.trim())}),Object.keys(I).length>0&&Object.entries(I).forEach(([m,h])=>{s.append(`especificaciones[${m}]`,h)}),[{key:"imagen_hero",file:r.get("imagen_hero")},{key:"imagen_especificaciones",file:r.get("imagen_especificaciones")},{key:"imagen_beneficios",file:r.get("imagen_beneficios")}].forEach((m,h)=>{m.file&&m.file.size>0?(console.log(`Agregando imagen ${h}:`,m.key,m.file.name),s.append(`imagenes[${h}]`,m.file),s.append(`imagen_tipos[${h}]`,m.key)):console.log(`Imagen ${h} (${m.key}) no tiene archivo o estÃ¡ vacÃ­a`)});const q=r.get("meta_tÃ­tulo"),B=r.get("meta_descripcion");(q.trim()||B.trim())&&(s.append("etiqueta[meta_titulo]",q.trim()),s.append("etiqueta[meta_descripcion]",B.trim())),s.forEach((m,h)=>{console.log(`Campo: ${h}, Valor: ${m}`)}),a&&s.append("_method","PUT"),await n(s)};return e.jsxs("form",{id:"product-form",onSubmit:d,className:"space-y-8 max-w-4xl mx-auto p-6",children:[e.jsxs("div",{className:"bg-blue-50 p-6 rounded-lg border border-blue-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-4 flex items-center",children:"Datos para Dashboard (GestiÃ³n Interna)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Nombre del Producto ",e.jsx("span",{className:"text-blue-600 text-sm",children:"(Aparece en tabla)"})]}),e.jsx("input",{name:"nombre",defaultValue:o?.nombre||o?.titulo,className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-blue-500 focus:border-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["SecciÃ³n/CategorÃ­a ",e.jsx("span",{className:"text-blue-600 text-sm",children:"(Aparece en tabla)"})]}),e.jsx("input",{name:"seccion",defaultValue:o?.seccion,placeholder:"ej: Letreros LED, Sillas LED, Pisos LED, etc.",className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-blue-500 focus:border-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Precio ",e.jsx("span",{className:"text-blue-600 text-sm",children:"(Aparece en tabla)"})]}),e.jsx("input",{name:"precio",defaultValue:o?.precio?`$${o.precio}`:o?.precio,placeholder:"ej: $500.00",className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-blue-500 focus:border-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Stock ",e.jsx("span",{className:"text-blue-600 text-sm",children:"(Control de inventario)"})]}),e.jsx("input",{type:"number",name:"stock",min:"0",className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-blue-500 focus:border-blue-500",required:!0})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Link/URL ",e.jsx("span",{className:"text-blue-600 text-sm",children:"(ej: letreros-neon-led)"})]}),e.jsx("input",{name:"link",defaultValue:o?.link||(o?.titulo?o.titulo.toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]/g,""):""),placeholder:"letreros-neon-led",className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-blue-500 focus:border-blue-500",required:!0})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Meta TÃ­tulo ",e.jsx("span",{className:"text-blue-600 text-sm",children:"(SEO)"})]}),e.jsx("input",{name:"meta_tÃ­tulo",defaultValue:o?.etiqueta?.meta_titulo||"",placeholder:"TÃ­tulo para SEO del producto",className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-blue-500 focus:border-blue-500",required:!0})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Meta DescripciÃ³n ",e.jsx("span",{className:"text-blue-600 text-sm",children:"(SEO)"})]}),e.jsx("textarea",{name:"meta_descripcion",defaultValue:o?.etiqueta?.meta_descripcion||"",rows:3,className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"DescripciÃ³n breve del producto para SEO...",required:!0})]})]})]}),e.jsxs("div",{className:"bg-green-50 p-6 rounded-lg border border-green-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-green-800 mb-4 flex items-center",children:"Datos para PÃ¡gina de Producto (Frontend)"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["TÃ­tulo Hero ",e.jsx("span",{className:"text-green-600 text-sm",children:"(Aparece sobre la imagen principal)"})]}),e.jsx("input",{name:"titulo_hero",defaultValue:o?.titulo,placeholder:"ej: Letreros NeÃ³n LED",className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-green-500 focus:border-green-500",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["DescripciÃ³n ",e.jsx("span",{className:"text-green-600 text-sm",children:'(SecciÃ³n "InformaciÃ³n")'})]}),e.jsx("textarea",{rows:4,name:"descripcion_informacion",defaultValue:o?.descripcion,placeholder:"Describe el producto, sus usos y caracterÃ­sticas principales...",className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-green-500 focus:border-green-500",required:!0})]})]})]}),e.jsxs("div",{className:"bg-purple-50 p-6 rounded-lg border border-purple-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-purple-800 mb-4 flex items-center",children:"Especificaciones (Checkmarks en el producto)"}),e.jsxs("div",{className:"space-y-3",children:[f.map((t,r)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{type:"text",value:t,onChange:s=>w(r,s.target.value),placeholder:"ej: Materiales duraderos",className:"flex-1 border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-purple-500 focus:border-purple-500"}),f.length>1&&e.jsx("button",{type:"button",onClick:()=>A(r),className:"text-red-500 hover:text-red-700 px-2 py-1",children:"âœ•"})]},r)),e.jsx("button",{type:"button",onClick:S,className:"text-purple-600 hover:text-purple-800 text-sm font-medium",children:"+ Agregar especificaciÃ³n"})]})]}),e.jsxs("div",{className:"bg-orange-50 p-6 rounded-lg border border-orange-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-orange-800 mb-4 flex items-center",children:"Beneficios (Lista en el producto)"}),e.jsxs("div",{className:"space-y-3",children:[i.map((t,r)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{type:"text",value:t,onChange:s=>T(r,s.target.value),placeholder:"ej: IluminaciÃ³n con colores vibrantes",className:"flex-1 border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-orange-500 focus:border-orange-500"}),i.length>1&&e.jsx("button",{type:"button",onClick:()=>y(r),className:"text-red-500 hover:text-red-700 px-2 py-1",children:"âœ•"})]},r)),e.jsx("button",{type:"button",onClick:l,className:"text-orange-600 hover:text-orange-800 text-sm font-medium",children:"+ Agregar beneficio"})]})]}),e.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:"ImÃ¡genes del Producto (4 imÃ¡genes especÃ­ficas requeridas)"}),c.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-md font-medium text-gray-700 mb-3",children:"ImÃ¡genes actuales"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:c.map(t=>e.jsxs("div",{className:"flex flex-col items-center p-4 bg-white rounded-lg shadow-sm border hover:shadow-md transition",children:[e.jsx("img",{src:`${t.url_imagen}`,alt:t.texto_alt_SEO,className:"w-32 h-32 object-cover rounded-lg mb-2"}),e.jsx("span",{className:"text-center text-gray-700 text-sm mb-2",children:t.texto_alt_SEO}),e.jsx("button",{type:"button",onClick:()=>_(t.id),className:"bg-red-100 text-red-600 text-xs px-3 py-1 rounded-full hover:bg-red-200 transition",children:"Eliminar"})]},t.id))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-blue-200",children:[e.jsxs("h4",{className:"text-md font-semibold text-blue-700 mb-3",children:["Imagen para Lista de Productos ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("p",{className:"text-sm text-gray-600 mb-3",children:['Esta imagen aparece en la pÃ¡gina "Nuestros Productos" y es ',e.jsx("strong",{children:"obligatoria"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"file",accept:"image/*",name:"imagen_lista_productos",required:!a,className:"w-full text-sm text-gray-600 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"}),e.jsx("input",{type:"text",name:"alt_imagen_lista",placeholder:"Texto ALT para SEO",className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-green-200",children:[e.jsxs("h4",{className:"text-md font-semibold text-green-700 mb-3",children:["ðŸŽ¯ Imagen Hero del Producto ",e.jsx("span",{className:"text-sm text-gray-500",children:"(Banner Principal)"})]}),e.jsxs("p",{className:"text-sm text-gray-600 mb-3",children:["Imagen de fondo grande en la pÃ¡gina individual del producto - ",e.jsx("strong",{children:"Banner superior principal"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"file",accept:"image/*",name:"imagen_hero",className:"w-full text-sm text-gray-600 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-green-50 file:text-green-700 hover:file:bg-green-100"}),e.jsx("input",{type:"text",name:"alt_imagen_hero",placeholder:"Texto ALT para SEO",className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-green-500 focus:border-green-500"})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-purple-200",children:[e.jsxs("h4",{className:"text-md font-semibold text-purple-700 mb-3",children:["ðŸ“‹ Imagen para Especificaciones ",e.jsx("span",{className:"text-sm text-gray-500",children:"(SecciÃ³n Izquierda)"})]}),e.jsxs("p",{className:"text-sm text-gray-600 mb-3",children:["Imagen que acompaÃ±a la secciÃ³n de especificaciones - ",e.jsx("strong",{children:"Lado izquierdo de la pÃ¡gina"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"file",accept:"image/*",name:"imagen_especificaciones",className:"w-full text-sm text-gray-600 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-purple-50 file:text-purple-700 hover:file:bg-purple-100"}),e.jsx("input",{type:"text",name:"alt_imagen_especificaciones",placeholder:"Texto ALT para SEO",className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-purple-500 focus:border-purple-500"})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-orange-200",children:[e.jsxs("h4",{className:"text-md font-semibold text-orange-700 mb-3",children:["ðŸŽ Imagen para Beneficios ",e.jsx("span",{className:"text-sm text-gray-500",children:"(SecciÃ³n Derecha)"})]}),e.jsxs("p",{className:"text-sm text-gray-600 mb-3",children:["Imagen que acompaÃ±a la secciÃ³n de beneficios - ",e.jsx("strong",{children:"Lado derecho de la pÃ¡gina"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"file",accept:"image/*",name:"imagen_beneficios",className:"w-full text-sm text-gray-600 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-orange-50 file:text-orange-700 hover:file:bg-orange-100"}),e.jsx("input",{type:"text",name:"alt_imagen_beneficios",placeholder:"Texto ALT para SEO",className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500"})]})]})]}),e.jsx("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-yellow-800",children:[e.jsx("strong",{children:"ðŸ’¡ Estructura CORRECTA de imÃ¡genes:"}),e.jsx("br",{}),"ðŸ“¸ ",e.jsx("strong",{children:"Lista Productos:"})," Imagen para vista de catÃ¡logo (imagen_principal)",e.jsx("br",{}),"ðŸŽ¯ ",e.jsx("strong",{children:"Hero:"})," Banner principal superior (images[0])",e.jsx("br",{}),"ðŸ“‹ ",e.jsx("strong",{children:"Especificaciones:"})," AcompaÃ±a caracterÃ­sticas (images[1])",e.jsx("br",{}),"ðŸŽ ",e.jsx("strong",{children:"Beneficios:"})," AcompaÃ±a ventajas (images[2])"]})})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-6 border-t border-gray-200",children:[e.jsx("button",{type:"button",className:"px-6 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600 transition",children:"Cancelar"}),e.jsxs("button",{type:"submit",className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition",children:[a?"Actualizar":"Crear"," Producto"]})]})]})};class W{async getAllProductos(){try{return await C.get(E.endpoints.productos.list)}catch(n){throw console.error("[ProductoService] Error obteniendo productos:",n),n}}async getProductoById(n){try{return await C.get(E.endpoints.productos.detail(n))}catch(a){throw console.error("[ProductoService] Error obteniendo producto:",a),a}}async createProducto(n){try{const a=this.buildFormData(n);return await C.authenticatedPostFormData(E.endpoints.productos.create,a)}catch(a){throw console.error("[ProductoService] Error creando producto:",a),a}}async updateProducto(n,a){try{const c=this.buildFormData(a);return await C.authenticatedPutFormData(E.endpoints.productos.update(n),c)}catch(c){throw console.error("[ProductoService] Error actualizando producto:",c),c}}async deleteProducto(n){try{return await C.authenticatedDelete(E.endpoints.productos.delete(n))}catch(a){throw console.error("[ProductoService] Error eliminando producto:",a),a}}buildFormData(n){const a=new FormData;return a.append("link",n.link),a.append("nombre",n.nombre),a.append("titulo",n.titulo),a.append("descripcion",n.descripcion),a.append("seccion",n.seccion),n.imagen_principal_file&&a.append("imagen_principal",n.imagen_principal_file),n.imagenes_files&&n.imagenes_files.forEach((c,N)=>{a.append(`imagenes[${N}]`,c)}),a}}const L=new W;function D(){const[o,n]=x.useState([]),[a,c]=x.useState(!0),[N,b]=x.useState(null),v=async()=>{c(!0),b(null);try{const u=await L.getAllProductos();n(u.data)}catch(u){b(u instanceof Error?u.message:"Error desconocido al obtener productos"),console.error("Error en useBlogs:",u)}finally{c(!1)}},k=async()=>{await v()};return x.useEffect(()=>{v()},[]),{productos:o,loading:a,error:N,refetch:k,createProduct:async u=>{c(!0),b(null);try{const i=await L.createProducto(u);return n(p=>[...p,i.data]),i.data}catch(i){return b(i instanceof Error?i.message:"Error desconocido al crear producto"),console.error("Error al crear producto:",i),null}finally{c(!1)}},updateProduct:async(u,i)=>{c(!0),b(null);try{const p=await L.updateProducto(u,i);if(!p.data)throw new Error("Producto no encontrado");return n(_=>_.map(w=>w.id===u?p.data:w)),p.data}catch(p){return b(p instanceof Error?p.message:"Error desconocido al actualizar producto"),console.error("Error al actualizar producto:",p),null}finally{c(!1)}}}}function re(){const{productos:o,loading:n,refetch:a}=D(),[c,N]=x.useState(1),b=8,[v,k]=x.useState(!1),[P,f]=x.useState(void 0),u=async l=>{const y=O(E.endpoints.productos.delete(l)),d=localStorage.getItem("token");if(!d){j.fire({title:"Error de autenticaciÃ³n",text:"No se encontrÃ³ token de acceso. Por favor inicia sesiÃ³n nuevamente.",icon:"error",confirmButtonText:"Entendido"});return}if((await j.fire({title:"Â¿EstÃ¡s seguro?",text:"Â¡Esta acciÃ³n no se puede deshacer!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"SÃ­, eliminar",cancelButtonText:"Cancelar"})).isConfirmed)try{console.log("ðŸ—‘ï¸ Eliminando producto ID:",l),console.log("URL delete:",y);const r=await fetch(y,{method:"DELETE",headers:{Accept:"application/json",Authorization:`Bearer ${d}`,"X-Requested-With":"XMLHttpRequest"}});console.log("Respuesta status:",r.status);const s=await r.json();if(console.log("Respuesta data:",s),r.ok)j.fire("Â¡Eliminado!",s.message,"success"),a();else{let g=s.message||"Error desconocido al eliminar";r.status===401?(g="Token expirado o invÃ¡lido. Por favor inicia sesiÃ³n nuevamente.",localStorage.removeItem("token")):r.status===403?s.message?.includes("roles")||s.error?.includes("roles")?g="No tienes el rol necesario para eliminar productos.":s.message?.includes("permission")||s.error?.includes("permission")?g="No tienes el permiso necesario para eliminar productos.":g="Acceso denegado. Contacta al administrador.":r.status===404&&(g="El producto no existe o ya fue eliminado."),j.fire("Error",g,"error")}}catch(r){console.error("Error al eliminar producto:",r),j.fire("Error","No se pudo conectar con el servidor.","error")}},i=c*b,p=i-b,_=o.slice(p,i),w=l=>{N(l)},S=Math.ceil(o.length/b),A=l=>{f(l),k(!0)},T=async function(l){const y=O(E.endpoints.productos.create),d=localStorage.getItem("token");if(!d){j.fire("Error","No hay token de autenticaciÃ³n. Por favor inicia sesiÃ³n.","error");return}console.log("Token exists:",!!d),console.log("Token length:",d.length),console.log("Token preview:",d.substring(0,20)+"..."),console.log("FormData entries:",[...l.entries()]);try{const t=P?O(E.endpoints.productos.update(P.id)):y;console.log("Making request to:",t);const r=await fetch(t,{method:"POST",headers:{Accept:"application/json",Authorization:`Bearer ${d}`,"X-Requested-With":"XMLHttpRequest"},body:l});console.log("Response status:",r.status),console.log("Response headers:",[...r.headers.entries()]);const s=await r.json();if(console.log("Response data:",s),r.ok)j.fire({title:`${s.message||"Producto guardado exitosamente"}`,icon:"success"}),k(!1),a();else{let g=s.message||"Error desconocido";r.status===401?(g="Token expirado o invÃ¡lido. Por favor inicia sesiÃ³n nuevamente.",localStorage.removeItem("token")):r.status===403?g="Acceso denegado. Permisos insuficientes.":r.status===422&&(g="Datos de entrada invÃ¡lidos: "+(s.message||"Verifica los campos del formulario")),j.fire("Error",g,"error")}}catch(t){console.error("Error en la peticiÃ³n:",t),j.fire({title:"Hubo un error al insertar el producto",icon:"error"})}};return x.useEffect(()=>(v?document.body.style.overflow="hidden":document.body.style.overflow="auto",()=>{document.body.style.overflow="auto"}),[v]),x.useEffect(()=>{},[]),x.useEffect(()=>{console.log("ðŸ“¦ Productos cargados:",o)},[o]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-row gap-4 mb-4",children:e.jsx("button",{onClick:()=>{f(void 0),k(!0)},className:"mt-4 bg-blue-950 hover:bg-blue-800 text-white text-lg px-10 py-1.5 rounded-full flex items-center gap-2",children:"AÃ±adir Producto"})}),e.jsxs(M,{tableType:"productos",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-cyan-400 dark:bg-cyan-600 text-white uppercase text-xs font-bold",children:[e.jsx("th",{className:"px-4 py-2 rounded-md",children:"ID"}),e.jsx("th",{className:"px-4 py-2 rounded-md",children:"NOMBRE"}),e.jsx("th",{className:"px-4 py-2 rounded-md",children:"SECCIÃ“N"}),e.jsx("th",{className:"px-4 py-2 rounded-md",children:"PRECIO"}),e.jsx("th",{className:"px-4 py-2 rounded-md",children:"ACCIÃ“N"})]})}),e.jsx("tbody",{children:n?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center py-12",children:e.jsxs("div",{className:"flex justify-center items-center gap-3",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-teal-500"}),e.jsx("span",{className:"text-teal-500 font-medium",children:"Cargando productos..."})]})})}):_.length>0?_.map((l,y)=>{const d=y%2===0,t=d?"bg-gray-100":"bg-gray-200",r=d?"dark:bg-gray-800":"dark:bg-gray-700",s="text-gray-900 dark:text-gray-100",g=l.id??`producto-${y}`;return e.jsxs("tr",{className:`${t} ${r}`,children:[e.jsx("td",{className:`px-4 py-2 font-bold rounded-md ${s}`,children:l.id}),e.jsx("td",{className:`px-4 py-2 font-bold rounded-md ${s}`,children:l.nombre}),e.jsx("td",{className:`px-4 py-2 font-bold rounded-md ${s}`,children:l.seccion}),e.jsxs("td",{className:`px-4 py-2 font-bold rounded-md ${s}`,children:["$",l.precio?l.precio.toFixed(2):""]}),e.jsx("td",{className:`px-4 py-2 rounded-md ${s}`,children:e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsx("button",{onClick:()=>A(l),className:"text-green-600 hover:text-green-800 dark:text-green-400 dark:hover:text-green-300",title:"Editar",children:e.jsx(F,{size:18})}),e.jsx("button",{onClick:()=>u(l.id),className:"text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300",title:"Eliminar",children:e.jsx(R,{size:18})})]})})]},g)}):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center py-16 text-gray-500",children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2",children:[e.jsx("div",{className:"bg-teal-50 p-6 rounded-full",children:e.jsx(z,{className:"h-10 w-10 text-teal-300"})}),e.jsx("p",{className:"text-xl font-medium text-gray-600 mt-4",children:"No hay productos registrados"}),e.jsx("p",{className:"text-gray-400 max-w-md mx-auto",children:"Comienza agregando productos a tu catÃ¡logo con el botÃ³n 'AÃ±adir Producto'"})]})})})})]}),S>1&&e.jsxs("div",{className:"flex justify-center items-center mt-4 gap-2",children:[e.jsx("button",{onClick:()=>w(c-1),disabled:c===1,className:"px-4 py-2 bg-blue-950 text-white rounded-md disabled:opacity-50 disabled:cursor-not-allowed",children:"Anterior"}),e.jsx("div",{className:"flex gap-1",children:Array.from({length:Math.min(5,S)},(l,y)=>{const d=y+1;return e.jsx("button",{onClick:()=>w(d),className:`px-3 py-2 rounded-md ${c===d?"bg-blue-950 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:d},d)})}),e.jsx("button",{onClick:()=>w(c+1),disabled:c===S,className:"px-4 py-2 bg-blue-950 text-white rounded-md disabled:opacity-50 disabled:cursor-not-allowed",children:"Siguiente"})]}),e.jsx(V,{isOpen:v,onClose:()=>{k(!1),f(void 0)},title:P?"Editar Datos":"Ingresar Datos",children:e.jsx(H,{initialData:P,onSubmit:T,isEditing:!!P})})]})}export{re as default};
